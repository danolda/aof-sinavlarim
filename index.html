<!doctype html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin – AÖF Soruları</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width: 900px; margin: 24px auto; padding: 0 12px; }
    h1 { font-size: 1.6rem; }
    .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
    textarea { width: 100%; min-height: 140px; padding: 8px; }
    .row { margin: 12px 0; }
    button { padding: 10px 14px; border: 0; border-radius: 8px; background:#007bff; color:#fff; cursor:pointer; }
    button.secondary { background:#555; }
    .bar { display:flex; gap:10px; align-items:center; margin-top: 8px; }
    input[type="password"], input[type="text"] { padding:8px; width: 280px; }
    .muted { color:#777; font-size: .9rem; }
    .ok { color: #28a745; }
    .err { color: #dc3545; }
  </style>
</head>
<body>
  <h1>Admin Paneli</h1>
  <p class="muted">URL’leri satır satır gir. <code>Kaydet</code>→<code>Scraper’ı Çalıştır</code>.</p>

  <div class="row bar">
    <label>API Base:&nbsp;</label>
    <input id="apiBase" type="text" placeholder="https://senin-vercel-domainin.vercel.app" />
    <input id="adminKey" type="password" placeholder="(opsiyonel) Admin Key" />
    <button onclick="loadConfig()">Yükle</button>
  </div>

  <div class="grid">
    <div>
      <h3>Ders1</h3>
      <textarea id="ders1"></textarea>
    </div>
    <div>
      <h3>Ders2</h3>
      <textarea id="ders2"></textarea>
    </div>
    <div>
      <h3>Ders3</h3>
      <textarea id="ders3"></textarea>
    </div>
    <div>
      <h3>Ders4</h3>
      <textarea id="ders4"></textarea>
    </div>
    <div style="grid-column: 1 / -1;">
      <h3>Ders5</h3>
      <textarea id="ders5"></textarea>
    </div>
  </div>

  <div class="bar">
    <button id="saveBtn">Kaydet</button>
    <button id="runBtn" class="secondary">Scraper’ı Çalıştır</button>
    <span id="status"></span>
  </div>

  <script>
    const $ = s => document.querySelector(s);
    const status = (t, cls="") => { const el = document.getElementById("status"); el.className = cls; el.textContent = t; };

    async function loadConfig() {
      const base = $('#apiBase').value.trim();
      if (!base) return;
      status('Yükleniyor...');
      try {
        const r = await fetch(base + '/api/config');
        const j = await r.json().catch(() => null);
        const cfg = j || { ders1:[], ders2:[], ders3:[], ders4:[], ders5:[] };
        for (const k of ['ders1','ders2','ders3','ders4','ders5']) {
          $('#' + k).value = (cfg[k] || []).join('\n');
        }
        status('Config yüklendi', 'ok');
      } catch (e) { status('Yüklenemedi', 'err'); }
    }

    async function save() {
      const base = $('#apiBase').value.trim(); if (!base) return alert('API Base gir');
      const adminKey = $('#adminKey').value.trim();
      const body = {};
      for (const k of ['ders1','ders2','ders3','ders4','ders5']) {
        body[k] = ($('#' + k).value || '').split(/\n+/).map(x=>x.trim()).filter(Boolean);
      }
      status('Kaydediliyor...');
      const r = await fetch(base + '/api/config', {
        method: 'POST', headers: { 'Content-Type':'application/json', 'x-admin-key': adminKey },
        body: JSON.stringify(body)
      });
      if (r.ok) status('Kaydedildi', 'ok'); else status('Kaydetme hatası', 'err');
    }

    async function runScraper() {
      const base = $('#apiBase').value.trim(); if (!base) return alert('API Base gir');
      const adminKey = $('#adminKey').value.trim();
      status('Workflow tetikleniyor...');
      const r = await fetch(base + '/api/dispatch', { method:'POST', headers:{ 'x-admin-key': adminKey }});
      if (r.ok) status('Tetiklendi. (GitHub Actions’ı kontrol et)', 'ok'); else status('Tetikleme hatası', 'err');
    }

    document.getElementById('saveBtn').addEventListener('click', save);
    document.getElementById('runBtn').addEventListener('click', runScraper);
  </script>
</body>
</html>
